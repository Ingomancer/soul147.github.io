
<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="a.css">
	<meta charset="UTF-8">
<!-- <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/A2285C8D-6804-9E48-B56F-292E94B644D2/main.js" charset="UTF-8"></script></head> -->
<body>
	<div>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="before">Before Life</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Episode</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Cake at Stake</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Contest</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Session</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Season</button>
		<button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="normal">New Life</button>
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New World</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New System</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Galaxy</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Galaxy Cluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Galaxy Supercluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Universe</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Multiverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Megaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Gigaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Teraverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Petaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Exaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Zettaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="cosmos">New Yottaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Reality</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Existence</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Transcendence</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Ultraverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Omniverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Monocosm</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Beyond</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Transcendentem</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Transcendentem Continuum</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Altarca</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="unima">New Metempiric Space</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="box">The Box</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Prestige</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Ascend</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Transcend</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Reset</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Reborn</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Sacrifice</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Resurrection</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Big Crunch</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-New Universe</button> -->
				<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Ultimate Fate</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Max</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Super Max</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Start Over</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Next Level</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Next Stage</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="again">Meta-Next Zone</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next World</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Planet</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Star</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Bubble</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Belt</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Galaxy</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Cluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Supercluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Next Supercluster Filament</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Big Freeze</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Big Rip</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Big Bang</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="repeat">Meta-Big Bounce</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Parallel Universe</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Multiverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Megaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Gigaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Teraverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Petaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Exaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Zettaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="sight">Meta-New Yottaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Reality</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Existence</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Transcendence</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Ultraverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Omniverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Monocosm</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Beyond</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Transcentendem</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Transcentendem Continuum</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Altarca</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="line">Meta-New Metempiric Space</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="metabox">The Meta-Box</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Prestige</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Ascend</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Transcend</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Reset</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Reborn</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Sacrifice</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Resurrection</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Big Crunch</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-New Universe</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Ultimate Fate</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Max</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Super Max</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Start Over</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Level</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Stage</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Zone</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next World</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Planet</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Star</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Bubble</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Belt</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Galaxy</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Cluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Supercluster</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Next Supercluster Filament</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Big Freeze</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Big Rip</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Big Bang</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="frontier">Pata-Big Bounce</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Parallel Universe</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Multiverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Megaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Gigaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Teraverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Petaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Zettaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Yottaverse</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Reality</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="ext">Pata-New Existence</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="aah">...</button> -->
		<!-- <button name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="corruption">The Box of Corruption</button> -->
		<button onclick = "tab('automation')" id = "AUTO" name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="box">Automation</button>
		<button onclick = "tab('achievements')" id = "ACHIEVEMENTS" name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="box">Achievements</button>
		<button onclick = "tab('options')" id = "OPTIONS" name = "layer" style="font-family: Typewriter; font-size: 20px; display: inline-block;" class="box">Options</button>
	</div>
	
	<center>
		<div style = "height: 80px">You have repelled <span id = "forks" style = "font-size: 30px"></span> forks.</div><br>
		<button onclick = "buyMaxAll()" class = "before">Max All (M)</button>
	</center>
	
	<div id = "Before Life" class = "tab">
		<table id = "frlist"></table>
	</div>

	<div id = "Layers"></div>
	
	<div id = "Automation" class = "tab">
		<table>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically buy all Fork Repellents</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically buy New Episode upgrades</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically start New Episode if keys will be doubled</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically start New Episodes as quickly as possible</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically buy New Cake at Stake upgrades</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically gain 1% of keys from New Episode every second</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically start New Cake at Stake if cakes will be doubled</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically buy New Contest upgrades</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically gain 1% of cakes from New Cake at Stake every second</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
			<tr><td class = "automaton"><input class = "automatonToggle" type = "checkbox">Automatically gain 1% of karma from New Contest every second</td><td>Consumes <span class = "automatonRequirement"></span> per second</td></tr>
		</table>
	</div>

	<div id = "Achievements" class = "tab">
		<table class = "achievement"></table>
	</div>
	
	<div id = "Options" class = "tab">
		Number Formatting: <select id="formatSelect" onchange="game.options.notation=document.getElementById(&quot;formatSelect&quot;).value">
			<option value="Mixed scientific">Mixed Scientific</option>
			<option value="Scientific">Scientific</option>
			<option value="Engineering">Engineering</option>
			<option value="Logarithm">Logarithm</option>
			<option value="Standard">Standard</option>
			<option value="Letters">Letters</option>
			<option value="Emojis">Cancer</option>
			<option value="Game percentages">Completion</option>
		</select><br>
		<br>
		<br>
		<button style = "font-size: 20px" class = "box" onclick = "save()">Manual Save</button><br>
		<button style = "font-size: 20px" class = "box" onclick = "ge('exportedSave').value = localStorage.wr; ge('exportedSave').select(); document.execCommand('copy'); alert('Save copied to clipboard.')">Export Save</button><br>
		<button style = "font-size: 20px" class = "box" onclick = "load(prompt('Paste your save here:'))">Import Save</button><br>
		<input style = "width: 140px" id = "exportedSave"></input><br>
		<br>
		<br>
		I take absolutely zero credit for this game. I just developed <a href = "https://sites.google.com/view/worldrestoration/main-page/main-game" target = "_blank">ItMarki's game concept</a>, using <a href = "https://github.com/Patashu/break_eternity.js" target = "_blank">Patashu's break_eternity.js</a> and formatting code taken from <a href = "https://ivark.github.io" target = "_blank">hevipelle's Antimatter Dimensions</a>.<br>
		<!-- Dravitar is making his own version of World Restoration, which can be found <a href = "https://dravitar.github.io/World-Restoration/" target = "_blank">here</a>. I would suggest playing that one too, they're basically two different games, each one unique and offering a different experience. -->
		<br>
		<br>
		<button style = "font-size: 20px" class = "sight" onclick = "if(confirm('WARNING: This will reset all of your progress. You will not be able to restore it. Do you really want to reset the game?')) {localStorage.removeItem('wr'); location.reload()}">HARD RESET</button><br>
	</div>
</body>

<script src="https://www.google-analytics.com/analytics.js"></script>

<script src = "break_eternity.js"></script>

<script src = "format.js"></script>
<script src = "automation.js"></script>
<script src = "achievements.js"></script>

<script>

// This is getting to be a thing, isn't it?

function ge(e) {
	return document.getElementById(e);
}

// Automatically iterate over all elements of a specific name or class

function gc(e, f) {
	l = document.getElementsByClassName(e);
	for(var i = 0; i < l.length; i++) {
		f(l[i], i); // pass the element and the position of the element in the array to function for each element
	}
}

function gn(e, f) {
	l = document.getElementsByName(e);
	for(var i = 0; i < l.length; i++) {
		f(l[i], i); // pass the element and the position of the element in the array to function for each element
	}
}

// Tab switching

function tab(t) {
	// hide everything
	
	var classList = document.getElementsByClassName("tab");
	for(var i = 0; i < classList.length; i++) {
		classList[i].style.display = "none"
	}
	
	// unhide the selected tab
	
	ge(t).style.display = ""
}

gn("layer", function(e) {
	e.onclick = function() {
		tab(e.innerHTML)
	}
})

// Setup repellent HTML

HTML = "<tr>"
for(var i = 1; i <= 80; i++) {
	if(i % 4 == 1) HTML += "</tr><tr>"
	HTML += '<td id = "fr'+i+'" width = "20%">Fork Repellent '+i+'<br>Amount: <span id = "fr'+i+'a"></span><br>Multiplier: x<span id = "fr'+i+'m"></span><br>Production: <span id = "fr'+i+'p"></span> / s<br><button id = "fr'+i+'b" onclick = "buyFR('+i+')">Requires <span id = "fr'+i+'c"></span> forks</button></td>'
}
ge("frlist").innerHTML += HTML

// Hotkeys

addEventListener("keydown", function(e) {
	var c = e.keyCode;
	
	if(c == 77) buyMaxAll()
})

// The game. Fairly simple.

game = {
	lastUpdate: Date.now(),
	options: {
		notation: "Mixed scientific",
		logarithm: {
			base: 10
		},
		commas: "Commas"
	},
	layers: [],
	automatonsActive: []
}

// This function is used a lot.

function reset(layer) {
	if(layer == 0) {
		game.forks = new Decimal(10);
		game.totalFRBought = new Decimal(0);
		for(var i = 1; i <= 80; i++) {
			j = i - 1;
			game["fr" + i] = {
				amount: new Decimal(0),
				bought: new Decimal(0),
				mult: new Decimal(1.2**j),
				buyMult: new Decimal(1.2),
				cost: new Decimal(10*1.7**j),
				costMult: new Decimal(1.5),
			}
		}
	}
	if(layer == 1) {
		game.keys = new Decimal(0);
		game.neUpgrades = [];
		game.keyMultiplier = new Decimal(1);
		game.keyMultiplierCost = new Decimal(1000);
		game.keyReductionUpgrades = new Decimal(0);
		game.keyReductionCost = new Decimal(10000);
	}
	if(layer == 2) {
		game.cakes = new Decimal(0);
		game.empoweredCakes = new Decimal(0);
		game.ncaUpgrades = [];
		game.cakeMultiplier = new Decimal(1);
		game.cakeMultiplierCost = new Decimal(1000);
		game.cakeMultiplier2 = new Decimal(1);
		game.cakeMultiplier2Cost = new Decimal(1e6);
		game.cakeReductionUpgrades = new Decimal(0)
		game.cakeReductionCost = new Decimal(1e7)
		game.brake = false;
	}
	if(layer == 3) {
		game.karma = new Decimal(0);
		game.ncUpgrades = []
		game.karmaMultiplier = new Decimal(1)
		game.karmaMultiplierCost = new Decimal(1000)
		game.karmaReductionUpgrades = new Decimal(0)
		game.karmaReductionCost = new Decimal(1e7)
	}
	
	if(layer == Infinity) {
		game.newEpisode = new Decimal(0);
		game.newCakeAtStake = new Decimal(0);
		game.newContest = new Decimal(0);
	}
}

function save() {
	localStorage.wr = btoa(JSON.stringify(game))
}

function load(file) {
	if(!localStorage.wr && !file) return;
	parsed = file ? JSON.parse(atob(file)) : JSON.parse(atob(localStorage.wr))
	if(parsed.forks) game = parsed; else return console.error("Error parsing save.")
	
	transformToDecimal(game)
	
	// Set up automatons
	
	automatons.forEach(function(automaton) {automaton.active = game.automatonsActive[automaton.id]})
	gn("automatonToggle", function(e, i) {e.checked = automatons[i].active})
	
	Achievements.asArray().forEach(function(achievement) {
		var table=document.getElementById("Achievements").childNodes[1]; //get the table
		var row=table.insertRow(-1); //append a row to the bottom
		var cell1=row.insertCell(0); //checkbox will be here
		var cell2=row.insertCell(1); //name will be here
		var cell3=row.insertCell(2); //description will be here
		var checkbox=document.createElement("INPUT");
		checkbox.setAttribute("class","achievemetCompletion");
		checkbox.setAttribute("type","checkbox");
		checkbox.setAttribute("disabled","disabled");
		cell1.appendChild(checkbox);
		cell1.style.paddingRight = "0px"
		cell2.innerHTML=achievement.name;
		cell3.innerHTML=achievement.desc;
		achievement.checkbox=checkbox;
	})
}

function transformToDecimal(object) { // It's so much better than hevi's version, because it's recursive and I'm a lazy piece of shit
	for(i in object) {
		if(typeof(object[i]) == "string" && !isNaN(new Decimal(object[i]).mag)) object[i] = new Decimal(object[i]); 
		if(typeof(object[i]) == "object") transformToDecimal(object[i]) // iterates over all objects inside the object
	}
}

</script>

<script src = "prestige_layer.js"></script>

<script>

const ENDGAME = 200
var ENDGAME_PROGRESS = 0
var ENDGAME_SPOILER = "Waluigi dies in Endgame, then comes back with the Eternity Gauntlet and kicks Thanos's ass." // I still haven't seen Infinity War. Don't spoil it.
var THE_END = false

// Cascading function to reset all layers below the current prestige layer

function prestige(layers) {
	// Gain currency and stuff
	
	if(layers != Infinity) {
		layer = game.layers[layers];
		layer.times = layer.times.add(1);
		console.log(layer.gainedCurrency())
		layer.currency = layer.currency.add(layer.gainedCurrency())
	}
	
	reset(layers) // don't run the loop infinite times, that wouldn't be good
	
	// Reset everything below
	
	for(var i = 0; i < Math.min(layers, 1000); i++) reset(i)
	buyFR(1);
}

function getUnlockedFR() {
	u = 1;
	
	for(var i = 0; i < game.layers.length; i++) {
		if(game.layers[i].times.gt(0)) u++;
	}
	
	return u;
}

function buyFR(n) {
	fr = game["fr" + n];
	if(game.forks.lt(fr.cost.divide(getFRCostReduction()))) return;
	
	var bought = game.forks.divide(fr.cost).log(fr.costMult).add(1);
	console.log(bought);
	
	fr.amount = fr.amount.add(bought);
	fr.bought = fr.bought.add(bought);
	game.totalFRBought = game.totalFRBought.add(bought)
	fr.mult = fr.mult.multiply(fr.buyMult.pow(bought))
	fr.cost = fr.cost.multiply(fr.costMult.pow(bought))
	return true;
}

function buyMaxAll() {
	for(var i = 1; i <= getUnlockedFR(); i++) buyFR(i);
}

function getFRCostReduction() {
	return 1
}

function update() {
	diff = Date.now() - game.lastUpdate;
	game.lastUpdate = Date.now();
	
	// Hackerman
	
	hacc = parseInt(localStorage.hacker) || 1
	diff *= hacc
	
	// Luigi dies in Infinity War
	
	ENDGAME_PROGRESS = Decimal.log10(Decimal.log10(game.forks))/Math.log10(ENDGAME)
	
	// You win
	
	if(ENDGAME_PROGRESS >= 1 && !THE_END) {
		setTimeout(function() {alert("You've reached the endgame. I'm still adding new content, which will be coming out soon. You can continue to push farther to get a head start, or just wait until the next layer comes out. Thanks for playing. :)")}, 1000)
		THE_END = true
	}
	
	for(var i = 1; i <= 80; i++) {
		fr = game["fr" + i]
		frb = game["fr" + (i-1)]
		fr.production = fr.amount.multiply(fr.mult)
		if(frb) frb.amount = frb.amount.add(fr.production.multiply(diff/1000)); else game.forks = game.forks.add(fr.production.multiply(diff/1000))
		
		ge("fr"+i+"a").innerHTML = shortenMoney(fr.amount);
		ge("fr"+i+"m").innerHTML = shorten(fr.mult);
		ge("fr"+i+"p").innerHTML = shortenMoney(fr.production);
		ge("fr"+i+"c").innerHTML = shortenMoney(fr.cost.divide(getFRCostReduction()));
		ge("fr"+i+"b").style.backgroundColor = game.forks.gte(fr.cost.divide(getFRCostReduction())) ? "#0f0" : "#f00"
		
		ge("fr"+i).style.display = (!game["fr" + (i-1)] || game["fr" + (i-1)].amount.gt(0)) && getUnlockedFR() >= i ? "" : "none"
	}
	
	game.layers.forEach(function(layer) {
		gn("currency" + layer.layerNumber, function(e, i) {
			e.innerHTML = layer.abbrC(i)
		})
		gn("prestige" + layer.layerNumber, function(e, i) {
			e.innerHTML = layer.abbrP(true)
		})
		gn("prestigerate" + layer.layerNumber, function(e, i) {
			e.innerHTML = shorten(layer.gainedCurrency().divide(layer.getTimeSpent()/60000)) + " " + layer.cName + ["","s","es"][layer.sinC-1] + "/min"
		})
	})
	
	updateAutomatons(diff / hacc);
	updateAchievements();
	
	//if(game.newEpisode.gt(0)) buyMaxAll();
	//if(game.newCakeAtStake.gt(0)) game.keys = game.keys.add(gainedKeys().multiply(diff/1e5))
	
	ge("forks").innerHTML = shortenMoney(game.forks);
	ge("forks").style.fontSize = 40 * (ENDGAME_PROGRESS + 1) + "px"
	
	
}

prestige(Infinity);

tab("Before Life")

//load();

setInterval(update, 50);
setInterval(save, 30000);

</script>
